rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Leaderboard collection - allow public reads, controlled writes
    match /leaderboard/{scoreId} {
      // Anyone can read the leaderboard
      allow read: if true;
      
      // Anyone can create new scores (for anonymous players)
      allow create: if request.resource.data.keys().hasAll(['name', 'score', 'lives', 'duration', 'timestamp', 'createdAt'])
        && request.resource.data.name is string
        && request.resource.data.score is number
        && request.resource.data.lives is number
        && request.resource.data.duration is number
        && request.resource.data.timestamp == request.time
        && request.resource.data.createdAt is string;
      
      // No updates or deletes allowed (data integrity)
      allow update, delete: if false;
    }
    
    // Analytics collection - for user interaction logs
    match /analytics/{logId} {
      // Only allow creation of analytics logs
      allow create: if request.resource.data.keys().hasAll(['event', 'timestamp'])
        && request.resource.data.event is string
        && request.resource.data.timestamp is string;
      
      // No reads, updates, or deletes
      allow read, update, delete: if false;
    }
    
    // Deny all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}